![マイクロソフト クラウド ワークショップ](https://github.com/Microsoft/MCW-Template-Cloud-Workshop/raw/master/Media/ms-cloud-workshop.png "マイクロソフト クラウド ワークショップ")

<div class="MCWHeader1">
Azure Synapse Analytics と AI
</div>
<div class="MCWHeader2">
ホワイトボード設計セッション受講者ガイド
</div>
<div class="MCWHeader3">
2020 年 7 月
</div>
このドキュメントに記載されている情報 (URL 等のインターネット Web サイトに関する情報を含む) は、将来予告なしに変更されることがあります。特に断りがない限り、ここで使用している会社、組織、製品、ドメイン名、電子メール アドレス、ロゴ、人物、場所、イベントの例は、架空のものであり、実在する会社、組織、製品、ドメイン名、電子メール アドレス、ロゴ、人物、場所、イベントなどとは一切関係ありません。お客様ご自身の責任において、適用されるすべての著作権関連法規に従ったご使用を願います。このドキュメントのいかなる部分も、米国 Microsoft Corporation の書面による許諾を受けることなく、その目的を問わず、どのような形態であっても、複製または譲渡することは禁じられています。ここでいう形態とは、複写や記録など、電子的な、または物理的なすべての手段を含みます。ただしこれは、著作権法上のお客様の権利を制限するものではありません。

マイクロソフトは、このドキュメントに記載されている内容に関し、特許、特許申請、商標、著作権、またはその他の無体財産権を有する場合があります。別途マイクロソフトのライセンス契約上に明示の規定のない限り、このドキュメントはこれらの特許、商標、著作権、またはその他の無体財産権に関する権利をお客様に許諾するものではありません。

製造元や製品の名前、URL は情報の提供のみを目的としており、マイクロソフトは、これらの製造元、またはマイクロソフトの技術での製品の使用について、明示的、黙示的、または法的にいかなる表示または保証も行いません。製造元または製品の使用は、マイクロソフトによるその製造元または製品の推奨を意味するものではありません。サード パーティのサイトへのリンクが提供されている場合があります。このようなサイトはマイクロソフトの管理下にはなく、マイクロソフトは、リンクされたサイトの内容またはリンクされたサイトに含まれるリンク、あるいはこのようなサイトの変更または更新について責任を負いません。マイクロソフトは、リンクされたサイトから受信された Web キャストまたは他のいかなる形態の転送にも責任を負いません。マイクロソフトは、これらのリンクを便宜のみを目的として提供しており、いかなるリンクの使用も、マイクロソフトによるサイトまたはそこに含まれる製品の推奨を意味するものではありません。

© 2020 Microsoft Corporation.All rights reserved.

Microsoft および <https://www.microsoft.com/en-us/legal/intellectualproperty/Trademarks/Usage/General.aspx> に記載されている商標は、Microsoft グループの商標です。その他すべての商標は、該当する各社が所有しています。

**目次**

<!-- TOC -->

- [Azure Synapse Analytics と AI ホワイトボード設計セッション受講者ガイド](#azure-synapse-analytics-と-ai-ホワイトボード設計セッション受講者ガイド)
    - [要約と学習目的](#要約と学習目的)
    - [ステップ 1: 顧客のケース スタディの確認](#ステップ-1-顧客のケース-スタディの確認)
        - [顧客の状況](#顧客の状況)
        - [顧客のニーズ](#顧客のニーズ)
        - [顧客の反論](#顧客の反論)
        - [一般的なシナリオのインフォグラフィック](#一般的なシナリオのインフォグラフィック)
    - [ステップ 2: 概念実証ソリューションの設計](#ステップ-2-概念実証ソリューションの設計)
    - [ステップ 3: ソリューションをプレゼンテーションする](#ステップ-3-ソリューションをプレゼンテーションする)
    - [まとめ](#まとめ)
    - [追加リファレンス](#追加リファレンス)

<!-- /TOC -->
# Azure Synapse Analytics と AI ホワイトボード設計セッション受講者ガイド

## 要約と学習目的

このホワイトボード設計セッションでは、グループを作って、Azure Synapse Analytics を使用してエンドツーエンドのソリューションを設計するプロセスを見ていきます。設計セッションでは、データ読み込み、データ準備、データ変換、およびデータ サービスについて説明し、機械学習の実行およびバッチ データとリアルタイム データの両方の処理についても説明します。

このホワイトボード設計セッションを完了すると、Azure Synapse Analytics を使用する完全なエンドツーエンドの高度な分析ソリューションを設計および構築できるようになります。

## ステップ 1: 顧客のケース スタディの確認

**成果**

顧客のニーズを分析する。

所要時間: 15 分

指示: セッションの参加者全員と共に、ファシリテーター/SME は、顧客のケース スタディの概要を技術的なヒントと併せてプレゼンテーションします。

1. テーブルの参加者およびトレーナーと打ち合わせを行います。

2. 受講者ガイドのステップ 1 ～ 3 の指示をすべて読みます。

3. テーブル チームとして、次の顧客のケース スタディを確認します。

### 顧客の状況

Wide World Importers (WWI) は、数百軒の実店舗とオンライン ストアを展開し、さまざまな製品を販売しています。

WWI は、データは小売業にとって "酸素" のようなものであると信じています。これまで小売業ではデータが不足することはありませんでしたが、WWI はこのデータの価値を最大限に活かすことができていませんでした。彼らは、断片化されたデータや顧客の行動や期待についての理解不足に悪戦苦闘していますが、カスタマー エクスペリエンス戦略を成功させるにはデータを効果的に使用することが不可欠であると信じています。

WWI は、小売データに分析を加えることで、見込み顧客および既存の顧客をその購買ジャーニーを通じて魅了する、パーソナライズされたオムニチャネル キャンペーンを改善する方法が明らかになる可能性があることを理解しています。

WWI は、顧客データ、運用データ、調達およびサプライヤー データ、取引データなど小売業のライフサイクル データに分析を組み合わせることによって、顧客離れの抑制、ロイヤルティの強化、カスタマー ジャーニーの向上、コンテクスト マーケティング実施能力の獲得、アトリビューションの測定を実現し、組織全体の成長を包括的に推進する企業全体にわたる洞察を提供することを望んでいます。

そのために、これまでのキャンペーンと顧客の分析データを使用して、現在について意思決定しようとしています。それらの大量のこれまでのデータ セット以外に、Twitter からのストリーミング ツイート データおよび実店舗の IoT センサーからのテレメトリを使用したいと考えています。実際に、今の瞬間に得たデータを利用して、次の瞬間のための意思決定に情報を提供したいと考えています。WWI は、まずは商品レコメンデーションを行うことによって、データから将来を予測する機会を見出します。

最高技術責任者 (CTO) の Peter Guerin 氏によれば、Wide World Importers では、Oracle に 300 億行を超える、5 年以上にわたる販売トランザクション データが保存されています。しかし、同社の企業データ ソースはそれだけではありません。SAP HANA に財務データ、Teradata にマーケティング データがそれぞれ保存され、さらに Twitter からソーシャル メディア データを取り込んでいます。必要なのは、これらのすべてのソースのデータを統合し、クエリを実行し、分析できるソリューションです。また、どんなに量が多くても、それらのデータに対してクエリを実行してから数秒以内に結果を得られることを望んでいます。

前述のデータ ソースに加えて、通路を歩く顧客の移動パターンを追跡するテレメトリ データを生成する店舗内 IoT センサーがあります。100 軒の店舗があり、店舗あたり 50 個のセンサーがリアルタイム データを提供します。このデータを使用して、人々がほとんどの時間を過ごしているのはどの売り場 (または通路群) で、ほとんど滞在しないのはどの売り場かを把握したいと考えています。このデータをほぼリアルタイムに取り込んで処理し、速やかにパターンを特定して店舗間で共有できるようにするソリューションを必要としています。たとえば、東海岸の店舗が開店したときの早い時間の購買行動で検出したパターンから、閉店前のセールや、開店前の西海岸の店舗での店内商品の配置替えに役立つ知識を得られる可能性があります。

WWI は、社内の専門家が、コードを作成して、または作成しないで、データの取り込みとデータの変換のパイプラインを作成できるようにするオプションを望んでいます。彼らはこれを実現するために、グラフィカル デザイナーを使用してそれらの変換パイプラインを容易に構築できるようにするツールを使用することと、彼らのチームが希望する場合はコードでそれを実装できるようにすることを望んでいます。

Guerin 氏は、自身の経験から、ツールに対する不満点は、予備調査のデータ分析をする前に必要なセットアップ作業量にあるとも述べています。そのため、WWI が取り込んだ生データを速やかに調査してその内容を理解できるソリューションを望んでいます。

Wide World Importers は、業務の全体像を把握するために、履歴データ、リアルタイムの Twitter センチメント、および IoT センサー データから導出した主要業績評価指標 (KPI)、さらに機械学習を使用して生成した主要商品レコメンデーションを確認できるダッシュボードの作成を必要としています。

### 顧客のニーズ

1. 履歴分析、リアルタイム分析、および予測分析を組み合わせてビジネスの洞察を得ること。

2. 構造化データ ソースと非構造化データ ソースを処理する統合アプローチを実現すること。

3. データ エンジニアとデータ サイエンティストから成るチームが、数ペタバイトに及ぶ数十億行の構造化データと企業業務の非構造化データに対する複雑なクエリを導入して実行できること。

4. ビジネス アナリストとデータ サイエンス/データ エンジニアリング チームが信頼できる唯一の情報源を共有できること。

5. 取り込み、変換、クエリ、および保存を行う際に使用する異種サービスの数を最小限に抑えて、データ エンジニア、データ サイエンティスト、およびデータベース管理者のチームが、1 つのツールを習得し、開発、管理、および監視を行うための共有ベスト プラクティスを構築できること。

6. 1 つのコラボレーション環境内で作業すること。

7. パフォーマンス上の懸念から、必ず、ソリューションの最高のパフォーマンスを達成するための中核となるアプローチが十分に理解されるようにすること。

8. すべてのコンポーネントにわたって一貫したセキュリティ モデルを提供するソリューションを作成すること。

### 顧客の反論

1. WWI は、Azure が提供するいくつかのサービスでは機能が重複していることを把握しています。望んでいる分析ソリューションになるように、時間をかけてそれらを調整したいとは考えていません。

2. 大量のデータセットを数秒以内で読み込むと主張する競合システムのデモを見たことがあります。Azure ではそのようなソリューションを提供していますか。

3. 取り込み、変換、クエリ、および保存を行う際に使用する異種サービスの数を最小限に抑えて、WWI のデータ エンジニア、データ サイエンティスト、およびデータベース管理者から成るチームが、1 つのツールを習得し、開発、管理、および監視を行うための共有ベスト プラクティスを構築できるようにすることが本当に可能ですか。

4. サーバーレス クエリのことを聞いたことがありますが、Azure では提供していますか。それは WWI が持つ規模のデータのクエリに対応できますか。どの形式をサポートしていますか。WWI のダッシュボードやレポートをサポートするのに適していますか。

5. Azure がサーバーレス クエリをサポートしている場合、サーバーレスを選択すると、事前に割り当てたクエリ リソースを使用するオプションは削除されますか。

6. 保存時のデータは保護されますか。データの暗号化に使用した鍵の管理は行われますか。

7. Azure Databricks と Azure Synapse Analytics は機能が重複しているように見えますが、何を基準にして選択するのですか。

8. Azure は、クライアント アプリケーションから簡単に呼び出すことができるように、Web サービスとしてのモデルの展開をどのようにサポートしていますか。

9. Azure において、モデルの再トレーニング プロセスはどのように実行されますか。WWI のデータ サイエンティストは、新しいモデルをトレーニングし、評価する一方で、アプリケーションに更新を展開するために使用される DevOps プロセスに、どのようにこの再トレーニングを確実に組み込むことができますか。Azure は、クライアント アプリケーション、機械学習 API、およびその API を支援するモデルに対する更新を調整するために役立ちますか。

### 一般的なシナリオのインフォグラフィック

![Azure Synapse Analytics の機能の概要。Azure Synapse Studio によるユーザー エクスペリエンス、SQL と Spark によるデータ処理用プラットフォーム、およびデータ レイクの統合管理を提供するソリューションの構成が示されています。](media/infographic.png "Azure Synapse Analytics の概要")

## ステップ 2: 概念実証ソリューションの設計

**成果**

ソリューションを設計し、そのソリューションを 15 分のチョークトーク形式で顧客の対象者にプレゼンテーションする準備をする。

所要時間: 60 分

**ビジネス ニーズ**

指示: テーブルのすべての参加者と共に以下の質問に回答し、回答をフリップ チャートに一覧にします。

1. このソリューションを誰にプレゼンテーションするべきか。顧客の対象者は誰か。意思決定者は誰か。

2. ソリューションで解決する必要がある顧客のビジネス ニーズは何か。

**設計**

指示: テーブルのすべての参加者と共に、フリップ チャートの次の質問に回答します。

アーキテクチャの概要

1. データ読み込み、データ変換、ストレージ、機械学習モデリング、およびレポートの最上位の要件に対応するための初期ビジョンを図示します。

取り込みと保存

1. 推奨するソリューションについて、フラット ファイル データを取り込んで保存した場所からデータ レイクに移動する場合に最も効率的なのは、具体的にはどのアプローチだと WWI に伝えますか。

2. どのストレージ サービスを使用するように勧めますか。さまざまな洗練レベルでデータを管理できるようにするために、どのようにフォルダーを構造化することを勧めますか。

3. 新しいデータ ソースからバッチで生データを取り込む場合、ソリューションではどのデータ形式をサポートできますか。

4. 店舗内 IoT デバイスからのストリーミング データをどのように取り込みますか。

変換

1. 生データを取り込んだ後、変換パイプラインを構築する前またはそれをデータ ウェアハウスに読み込む前に、WWI はどのようにして速やかにその生データを調査してその内容を理解できるのでしょうか。

2. 洗練したバージョンのデータをクエリできるように保存する場合、どのデータ形式を使用することを勧めますか。それはなぜですか。

3. データの準備、マージ、および変換に使用するように勧めるサービスについて、どの状況でグラフィカル デザイナーを使用できて、どの状況でコードを作成する必要がありますか。

4. WWI のデータ チームは、データの速やかな前処理と、データ サイエンティストによる Spark と Python の両方を使用した機械学習モデルのトレーニングを可能にするオープン ソース パッケージを利用することに慣れています。マイクロソフトのソリューションでそれを実現する方法を説明してください。

5. マイクロソフトのソリューションでは、WWI のデータ エンジニアとデータ サイエンティストが Jupyter ノートブック内で作業できますか。ライブラリをどのように管理しますか。

6. このソリューションは、サプライヤーの請求書によって、データ ウェアハウス内の部品コスト テーブルを常に更新する必要性にどのように対応しますか。

クエリ

WWI の販売トランザクション データセットは 10 億行を超えています。ダウンストリームのレポート クエリのために、これらの行を数十秒以内で結合、射影、およびフィルターできるようにする必要があります。WWI は、これを実現するにはあまりにデータが多すぎることを懸念しています。

1. ファクト テーブルで前述のパフォーマンスを達成するには、具体的にどのインデックス作成手法を使用する必要がありますか。それはなぜですか。

2. 1 億行未満のテーブルにも同じアプローチを勧めますか。

3. 小規模なルックアップ テーブル (店舗の名称や住所が保存されているテーブルなど) のインデックスはどのように構成する必要がありますか。

4. 1 行のみを取得するポイント ルックアップにのみ使用する大規模なルックアップ テーブルにはどんなことを提案しますか。複数のクエリがフィルタリングする列が異なっていても効率的にルックアップできるように、大規模なルックアップ テーブルの柔軟性を高めるにはどうすればいいですか。

5. ステージング テーブルの読み込みを最も速くするには、何を使用する必要がありますか。

6. 以下に示すシナリオでの**分散**テーブル設計に関して注意する必要がある典型的な問題には何がありますか。
   
   - 最も小さいファクト テーブルが数 GB を超えていて、本質的に挿入が頻繁に行われます。
   
   - WWI のデータ チームは、データ ウェアハウスを開発する際に生の入力データから役に立つかもしれないテーブルをいくつか作成しましたが、現在それらのテーブルは他のテーブルと結合されておらず、データ分散に使用するのに最適な列も不明です。
   
   - WWI のデータ エンジニアは、データを準備する際に、一時ステージング テーブルを使用することがあります。
   
   - 数百 MB から 1.5 GB までの規模のルックアップ テーブルがあります。

7. データの一部に JSON 形式の列が含まれています。どうすればこれらの階層フィールドを表形式構造に平坦化できますか。

8. JSON データを更新するのにどんなアプローチを使用できますか。

9. WWI は、一部のクエリでは、結果を返す時間を短縮できるのであれば、精度が多少落ちるのは構わないと考えています。どうすればそれを実現できますか。

10. ダウンストリームのレポートは多数のユーザーが使用します。これは多くの場合、それほど頻繁に変化しないデータに対して同じクエリが繰り返し実行されることを意味します。何を使用すると、このようなタイプのクエリのパフォーマンスを高めることができますか。基礎となるデータが変化する場合、このアプローチはどのように機能しますか。

可視化

1. WWI は、どの製品を使用すると、小売トランザクション データを可視化できますか。それはインストールする必要がある独立したツールですか。

2. その同じツールを使用して、バッチ データとストリーミング データの両方を 1 つのダッシュボード画面で可視化できますか。

3. 推奨する製品を使用する場合、データを参照するレポートを作成する前に、すべてのデータをデータ ウェアハウスに読み込む必要がありますか。

管理

1. これまで、WWI のシステムはユーザーに人気がありませんでした。時間的制約のない調査クエリが使用可能なリソースを飽和状態にして、重要なレポートを作成するための優先度の高いクエリの実行を遅らせていました。推奨するソリューションがこれを解決するのにどのように役立つのか説明してください。

2. 推奨するソリューションは、テーブル分散が最適ではない、データ スキュー、キャッシュ ミス、tempdb 競合、プラン選択が最適ではないなどの問題を WWI が検出するのを支援するために何を提供しますか。

3. WWI は、データ ウェアハウス ソフトウェアを最新の状態に保つには、それに伴うダウンタイムを許容できるタイミングを決める必要があることを理解しています。推奨するソリューションでは、どうすれば WWI は予期しないアップグレードに慌てることのない設定を確立できますか。

安全性

1. 推奨するソリューションは、たとえば SQL と Spark のワークロードに対して、どのようにして統合された認証を提供しますか。

2. Azure Data Lake Store Gen2 に保存されているデータに対するデータ アクセスをどのように承認しますか。Azure Synapse SQL データベースに保存されているデータについてはどうですか。

3. WWI の課題の 1 つは、複数の部門が特定のテーブルに対するクエリを実行できる可能性がある一方で、各自にどのデータの表示が許可されるのかは部門または社内での役割によって決まることです。推奨するソリューションでは、これをどのようにサポートできますか。3 つの選択肢を提案する必要があります。

4. そのソリューションは、WWI がセキュリティの構成ミスを検出、追跡、および修復し、脅威を検出するのに役立ちますか。どんな方法ですか。

5. WWI はこのソリューションを使用して、機密情報を検出、分類、および保護し、機密情報へのアクセスを追跡できるようにすることで、機密情報を監視できますか。

6. ネットワーク セキュリティの観点から、推奨するソリューションをどのように保護する必要がありますか。

**準備**

指示: テーブルのすべての参加者と共に、以下を行います。

1. 提案したソリューションでは対応していない顧客ニーズを特定する。

2. ソリューションの利点を特定する。

3. 顧客の反論にどのように回答するかを決定する。

顧客に対する 15 分のチョークトーク形式のプレゼンテーションを準備する。

## ステップ 3: ソリューションをプレゼンテーションする

**成果**

顧客の対象者にソリューションを 15 分のチョークトーク形式でプレゼンテーションする。

所要時間: 30 分

**プレゼンテーション**

指示:

1. 別のテーブルとペアを組む。

2. 一方のテーブルはマイクロソフト チーム、他方のテーブルは顧客とする。

3. マイクロソフト チームは提案ソリューションを顧客にプレゼンテーションする。

4. 顧客は反論リストから反論を 1 つ行う。

5. マイクロソフト チームは反論に回答する。

6. 顧客チームはマイクロソフト チームにフィードバックを提供する。

7. テーブル間で役割を切り替えて、ステップ 2 ～ 6 を繰り返す。

## まとめ

所要時間: 15 分

指示: より大きなグループでテーブルに再度集まり、ファシリテーター/SME がこのケース スタディの推奨ソリューションを共有するのを聞きます。

## 追加リファレンス

|                               |                                                                                                |
|-------------------------------|------------------------------------------------------------------------------------------------|
| **説明** | **リンク** |
| Azure Synapse Analytics とは| https://docs.microsoft.com/en-us/azure/synapse-analytics/sql-data-warehouse/sql-data-warehouse-overview-what-is
| Azure Synapse Analytics ソリューションの早見表| https://docs.microsoft.com/en-us/azure/synapse-analytics/sql-data-warehouse/cheat-sheet
| Azure Synapse Analytics の FAQ| https://docs.microsoft.com/en-us/azure/synapse-analytics/sql-data-warehouse/sql-data-warehouse-overview-faq
| Azure SQL Database の高度なデータ セキュリティ| https://docs.microsoft.com/en-us/azure/sql-database/sql-database-advanced-data-security?toc=/azure/synapse-analytics/sql-data-warehouse/toc.json\&bc=/azure/synapse-analytics/sql-data-warehouse/breadcrumb/toc.json
| Azure SQL DB および Data Warehouse のプライベート リンク| https://docs.microsoft.com/en-us/azure/sql-database/sql-database-private-endpoint-overview?toc=/azure/synapse-analytics/sql-data-warehouse/toc.json\&bc=/azure/synapse-analytics/sql-data-warehouse/breadcrumb/toc.json
| 列レベルのセキュリティ| https://docs.microsoft.com/en-us/azure/synapse-analytics/sql-data-warehouse/column-level-security
| 行レベルのセキュリティ| https://docs.microsoft.com/en-us/sql/relational-databases/security/row-level-security?toc=%2Fazure%2Fsynapse-analytics%2Fsql-data-warehouse%2Ftoc.json\&bc=%2Fazure%2Fsynapse-analytics%2Fsql-data-warehouse%2Fbreadcrumb%2Ftoc.json\&view=sql-server-ver15
| 動的データ マスク| https://docs.microsoft.com/en-us/azure/sql-database/sql-database-dynamic-data-masking-get-started?toc=%2Fazure%2Fsynapse-analytics%2Fsql-data-warehouse%2Ftoc.json\&bc=%2Fazure%2Fsynapse-analytics%2Fsql-data-warehouse%2Fbreadcrumb%2Ftoc.json\&view=sql-server-ver15
| Transparent Data Encryption| https://docs.microsoft.com/en-us/azure/sql-database/transparent-data-encryption-azure-sql?toc=%2Fazure%2Fsynapse-analytics%2Fsql-data-warehouse%2Ftoc.json\&bc=%2Fazure%2Fsynapse-analytics%2Fsql-data-warehouse%2Fbreadcrumb%2Ftoc.json\&view=sql-server-ver15\&tabs=azure-portal
| JSON 関数| https://docs.microsoft.com/en-us/sql/t-sql/functions/json-functions-transact-sql?toc=%2Fazure%2Fsynapse-analytics%2Fsql-data-warehouse%2Ftoc.json\&bc=%2Fazure%2Fsynapse-analytics%2Fsql-data-warehouse%2Fbreadcrumb%2Ftoc.json\&view=sql-server-ver15
| 結果セットのキャッシュ| https://docs.microsoft.com/en-us/azure/synapse-analytics/sql-data-warehouse/performance-tuning-result-set-caching?view=sql-server-ver15
| Synapse Analytics のテーブルの概要| https://docs.microsoft.com/en-us/azure/synapse-analytics/sql-data-warehouse/sql-data-warehouse-tables-overview?view=sql-server-ver15
| ワークロード管理| https://docs.microsoft.com/en-us/azure/synapse-analytics/sql-data-warehouse/sql-data-warehouse-workload-management?view=sql-server-ver15
| Azure Data Lake Store Gen2 の概要| https://docs.microsoft.com/en-us/azure/storage/blobs/data-lake-storage-introduction
| Azure Stream Analytics| https://docs.microsoft.com/en-us/azure/stream-analytics/stream-analytics-introduction

